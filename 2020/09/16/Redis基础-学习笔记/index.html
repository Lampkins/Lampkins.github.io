<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="renderer" content="webkit">

  
  <title>Redis基础 学习笔记 | 博客</title>

  <link rel="shortcut icon" href="/images/favicon.png">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <meta name="description" content="Redis 是一个内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。  ¶ NoSQL概述 NoSQL &#x3D; Not Only SQL 不仅仅是SQL 关系型数据库：表格，行、列 很多的数据类型，如用户的个人信息、社交网络、地理位置。这些数据类型的存储不需要一个固定的格式， 不需要多余的操作就可以横向扩展。 ¶ 特点  方便扩展(数据之间没有关系，很好扩展! ) 大数据量高性能( Red">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis基础 学习笔记">
<meta property="og:url" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="博客">
<meta property="og:description" content="Redis 是一个内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。  ¶ NoSQL概述 NoSQL &#x3D; Not Only SQL 不仅仅是SQL 关系型数据库：表格，行、列 很多的数据类型，如用户的个人信息、社交网络、地理位置。这些数据类型的存储不需要一个固定的格式， 不需要多余的操作就可以横向扩展。 ¶ 特点  方便扩展(数据之间没有关系，很好扩展! ) 大数据量高性能( Red">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201001180930883-1603273481613.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002175210711-1603273481614.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002191438203-1603273481614.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002223857890-1603273481615.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002223944105-1603273481615.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002225013710-1603273481615.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002232010221-1603273481615.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201003180444252-1603273481615.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201003193304549-1603273481616.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201003193545996-1603273481616.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201021164003157.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201021165228987.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201021165652288.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201021170505844.png">
<meta property="og:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201021170804287.png">
<meta property="article:published_time" content="2020-09-16T14:14:16.000Z">
<meta property="article:modified_time" content="2020-11-05T11:40:00.326Z">
<meta property="article:author" content="Lampkins">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201001180930883-1603273481613.png">

  <meta name="keywords" content=",Java,Redis">
  <meta name="format-detection" content="telephone=no,email=no">
  <meta name="theme-color" content="#9C27B0">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="博客">
  <meta name="msapplication-starturl" content="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
  <meta name="msapplication-navbutton-color" content="#9C27B0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="博客">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/images/favicon.png">

  
    <link rel="canonical" href="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
  

  
  

  
  
  

  
<link rel="stylesheet" href="/css/mdui.css">
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/custom.css">

<meta name="generator" content="Hexo 5.2.0"></head>
<body class="mdui-appbar-with-toolbar mdui-theme-primary-blue-grey mdui-theme-accent-blue">
  <script>var a=localStorage.getItem("mdui-theme-layout-dark");if(a){document.getElementsByTagName("body")[0].className+=" mdui-theme-layout-dark"};</script>
  <script>var a=localStorage.getItem("mdui-drawer-close");if(!a){document.getElementsByTagName("body")[0].className+=" mdui-drawer-body-left"};</script>
  <header id="header" class="mdui-appbar mdui-appbar-fixed mdui-appbar-scroll-hide mdui-appbar-inset">
  <div class="mdui-toolbar mdui-color-theme">
    <a href="javascript:;" class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', swipe: true}"><i class="mdui-icon material-icons">menu</i></a>
    <a href="/" class="mdui-typo-headline">博客</a>
    <div class="mdui-toolbar-spacer"></div>
    <a href="javascript:;" class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#search'}" mdui-tooltip="{content: '搜索'}"><i class="mdui-icon material-icons">search</i></a>
    <a href="/atom.xml" class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'RSS'}"><i class="mdui-icon material-icons">rss_feed</i></a>
    <a id="mode" href="javascript:;" class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'D/N'}"><i class="mdui-icon material-icons">brightness_5</i></a>
  </div>
</header>
<div class="mdui-dialog" id="search">
  
    <div class="search-form">
      <input type="search" class="search-form-input" placeholder="请输入关键字">
    </div>
    <div class="search-result" data-resource="/search.xml"></div>
  
</div>
  <aside id="sidebar" class="mdui-drawer mdui-drawer-full-height mdui-shadow-3">
  <script>var a=localStorage.getItem("mdui-drawer-close");if(a){document.getElementById("sidebar").className+=" mdui-drawer-close"};</script>
  <div class="mdui-grid-tile">
    <img src="/images/banner1.jpg" style="height: auto;">
    <img src="/images/avatar1.jpg" class="avatar-animation" style="position: absolute; top: 10%; left: 24px; width: 64px; height: 64px; border: 2px solid #fff; border-radius: 50%;">
    <div class="mdui-grid-tile-actions">
      <div class="mdui-grid-tile-text">
        <div class="mdui-grid-tile-title">Lampkins</div>
        <div class="mdui-grid-tile-subtitle"><i class="mdui-icon material-icons">art_track</i>Creator by ❤️</div>
      </div>
      
        <div class="mdui-grid-tile-buttons">
          <a href="mailto:arivins_lau@foxmail.com" class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'arivins_lau@foxmail.com'}"><i class="mdui-icon material-icons">email</i></a>
        </div>
      
    </div>
  </div>

  <div class="mdui-list" mdui-collapse="{accordion: true}">
    <a href="/" class="mdui-list-item mdui-ripple">
      <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue">home</i>
      <div class="mdui-list-item-content">主页</div>
    </a>
    <div class="mdui-collapse-item">
      <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-deep-orange">archive</i>
        <div class="mdui-list-item-content">归档</div>
        <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
      </div>
      <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
        
        <a class="mdui-ripple sidebar_archives-link" href="/archives/2022/02/">二月 2022<span class="mdui-ripple sidebar_archives-count">3</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2021/08/">八月 2021<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2020/11/">十一月 2020<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2020/10/">十月 2020<span class="mdui-ripple sidebar_archives-count">10</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2020/09/">九月 2020<span class="mdui-ripple sidebar_archives-count">4</span></a>
        
      </div>
    </div>
    <div class="mdui-collapse-item">
      <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-green">class</i>
        <div class="mdui-list-item-content">分类</div>
        <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
      </div>
      <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
        
        <a class="mdui-ripple sidebar_archives-link" href="/categories/Java/">Java<span class="mdui-ripple sidebar_archives-count">6</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库<span class="mdui-ripple sidebar_archives-count">10</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">MySQL性能优化<span class="mdui-ripple sidebar_archives-count">8</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/%E9%98%BF%E9%87%8C%E4%BA%91/">阿里云<span class="mdui-ripple sidebar_archives-count">1</span></a>
        
      </div>
    </div>
    <div class="mdui-collapse-item">
      <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-brown">bookmark</i>
        <div class="mdui-list-item-content">标签</div>
        <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
      </div>
      <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
        
        <a class="mdui-ripple sidebar_archives-link" href="/tags/ACID/" rel="tag">ACID<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/B-%E6%A0%91/" rel="tag">B+树<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/B%E6%A0%91/" rel="tag">B树<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/JMM/" rel="tag">JMM<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/JVM/" rel="tag">JVM<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/Java/" rel="tag">Java<span class="mdui-ripple sidebar_archives-count">4</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/Java%E9%94%81/" rel="tag">Java锁<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/MySQL/" rel="tag">MySQL<span class="mdui-ripple sidebar_archives-count">8</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/Redis/" rel="tag">Redis<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/Spring/" rel="tag">Spring<span class="mdui-ripple sidebar_archives-count">3</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/SpringMVC/" rel="tag">SpringMVC<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/markdown/" rel="tag">markdown<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/%E4%BA%8B%E5%8A%A1/" rel="tag">事务<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/%E4%BC%98%E5%8C%96/" rel="tag">优化<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86/" rel="tag">日志采集<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/%E7%B4%A2%E5%BC%95/" rel="tag">索引<span class="mdui-ripple sidebar_archives-count">8</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式<span class="mdui-ripple sidebar_archives-count">1</span></a>
        
      </div>
    </div>
    <a href="/about" class="mdui-list-item mdui-ripple">
      <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-purple">person</i>
      <div class="mdui-list-item-content">关于</div>
    </a>
  </div>

  <div class="mdui-divider"></div>

  <div class="mdui-list" mdui-collapse="{accordion: true}">
    
      <a href="/timeline" class="mdui-list-item mdui-ripple">时间轴</a>
    
      <a href="/tagcloud" class="mdui-list-item mdui-ripple">标签云</a>
    
      <a href="/gallery" class="mdui-list-item mdui-ripple">画　廊</a>
    
    <div class="mdui-collapse-item">
      <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
        <div class="mdui-list-item-content">友情链接</div>
        <i class="mdui-list-item-icon mdui-icon material-icons">link</i>
      </div>
      <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
        
          <a href="/pdf/简历.pdf" target="_blank" class="mdui-list-item mdui-p-l-2 mdui-text-color-theme-accent mdui-ripple" style="justify-content: center;">个人简历</a>
        
          <a href="https://imgchr.com/3312862586" target="_blank" class="mdui-list-item mdui-p-l-2 mdui-text-color-theme-accent mdui-ripple" style="justify-content: center;">路过图床</a>
        
          <a href="https://github.com/Lampkins/Lampkins.github.io" target="_blank" class="mdui-list-item mdui-p-l-2 mdui-text-color-theme-accent mdui-ripple" style="justify-content: center;">博客托管</a>
        
        
      </div>
    </div>
  </div>
</aside>
  <main id="main" class="mdui-m-t-5 fadeIn animated">
  
<link rel="stylesheet" href="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.css">

  <style>#main article .mdui-card-content .center-block{display:block!important;margin-right:auto!important;margin-left:auto!important}</style>
  <article class="mdui-card mdui-m-b-5" style="margin-top: -40px !important;">
    <header class="mdui-card-media">
      <img src="/images/random/material-6.png" style="max-height: 240px;">
      <div class="mdui-card-media-covered">
        <div class="mdui-card-primary">
          <div class="mdui-card-primary-title">Redis基础 学习笔记</div>
          <div class="mdui-card-primary-subtitle">
            
            <i class="iconfont">&#xe697;</i> 2020-09-16 / <i class="iconfont">&#xe601;</i> Lampkins &nbsp;&nbsp; <span id="busuanzi_container_page_pv" style="display: none;"><i class="iconfont">&#xe7fd;</i> <span id="busuanzi_value_page_pv"></span></span>
          </div>
        </div>
      </div>
      <div class="mdui-card-menu">
        
          <button class="mdui-btn mdui-btn-icon mdui-text-color-white" mdui-menu="{target: '#qrcode', align: 'right'}"><i class="mdui-icon material-icons">devices</i></button>
          <ul class="mdui-menu" id="qrcode">
            
              <li class="mdui-menu-item"><a class="mdui-text-center mdui-ripple">发送到手机</a></li>
            
            <li class="mdui-menu-item" disabled>
              
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAADhklEQVR42u3awW4iQQwE0Pz/T+9eI60gVXY3EO2bU5QQGL85FHb764/r2/WFAAcOHDhw4MCBAweOD+b4iq/vr3/41g9emf/87/s///2mFhw4cODAcY/jhyh6etM5WU756K+PSprVggMHDhw4bnPk4VrE2Ciqk7Kfv3NRCw4cOHDgeCvH81YqKWYTrnnQ4sCBAweO38Lx/EaTUvdB/mu+d+DAgQPHf89RDNSCEeGpsGzv6qWzUhw4cODAcXSh4TN/ftt+Bw4cOHDgGF1JuCZt3uyAqh0+RhXhwIEDB46jHPka3Gxh7uwhVjuOjJpMHDhw4MBxjWM/FkzCdV/MrL3EgQMHDhyv5Mibpfz3ebPXtnxJwBePHAcOHDhwHOXIlwlmxbcoSZFt6D5HwYEDBw4cZzn2EbhZs8sHf/nDqwMeBw4cOHBc4KjDqQzLfBTYHm7NPgsHDhw4cNzjaCPwQLAFN90G/+YrAg4cOHDgOMuRFzMrNQnyWXwmg8ioycSBAwcOHNc4Zjfatlt5VLcjwvzB4MCBAweO2xztTSchl0Pni3ezdhEHDhw4cLyX4+ySQT5SnB2G5Vg4cODAgeNdHHmjla9B5EdNswOt2VoGDhw4cOC4wbFfa6g/Pj4Qmo0j64eHAwcOHDiOcuT/lsPlETsL2tmh13BVDgcOHDhwlBybFqgdI7al5rizR4UDBw4cOG5wbBqzfN1hE95JO5e3jtH3Dhw4cODAseZoS9qsu51ag8irqBcacODAgQPHUY5NeXmzlxxK5fTtw8OBAwcOHPc4kibt3hHU89e0q3WzQScOHDhw4LjNkbdbCVle8KnYzkMdBw4cOHDc42g/eHak1HLMwri9Qxw4cODA8UqO1ccEo7o2YvPms1ihwIEDBw4cRznywd/s9cNbjJchNs0kDhw4cOC4wdFe+2WCdqFh8+nRMBEHDhw4cFzg+CqvNuQ2Y76kvM3948CBAweOGxyngrZtxnKI5yG6GRfiwIEDB46zHG04zYrJh4Z5G7Zp23DgwIEDx22O9tgpP+Bpl+qSID/VUuLAgQMHjtscm1W2YhhXNmA536xRxIEDBw4c7+WYlZcH+bEi8/vHgQMHDhwfwNGG8b6MlrJoDnHgwIEDxzWOTRC2o8B2SW7z2H64Exw4cODAcYFjv9CQ/1e+vnD2GAwHDhw4cLyGw4UDBw4cOHDgwIEDB44Pu/4C4DROz35HtOcAAAAASUVORK5CYII=">
              
            </li>
          </ul>
        
        
          <button class="mdui-btn mdui-btn-icon mdui-text-color-white" mdui-menu="{target: '#share_menu', align: 'right'}"><i class="mdui-icon material-icons">share</i></button>
          <ul class="mdui-menu" id="share_menu">
            <li class="mdui-menu-item">
              <a href="http://service.weibo.com/share/share.php?appkey=&title=Redis基础 学习笔记&url=http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&pic=http://lampkins.gitee.io/images/favicon.png&searchPic=false&style=simple" target="_blank" class="mdui-ripple">分享到 Weibo</a>
            </li>
            <li class="mdui-menu-item">
              <a href="https://twitter.com/intent/tweet?text=Redis基础 学习笔记&url=http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&via=Lampkins" target="_blank" class="mdui-ripple">分享到 Twitter</a>
            </li>
            <li class="mdui-menu-item">
              <a href="https://www.facebook.com/sharer/sharer.php?u=http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" class="mdui-ripple">分享到 Facebook</a>
            </li>
            <li class="mdui-menu-item">
              <a href="https://plus.google.com/share?url=http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" class="mdui-ripple">分享到 Google+</a>
            </li>
            <li class="mdui-menu-item">
              <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=Redis基础 学习笔记" target="_blank" class="mdui-ripple">分享到 LinkedIn</a>
            </li>
            <li class="mdui-menu-item">
              <a href="http://connect.qq.com/widget/shareqq/index.html?site=博客&title=Redis基础 学习笔记&pics=http://lampkins.gitee.io/images/favicon.png&url=http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" class="mdui-ripple">分享到 QQ</a>
            </li>
            <li class="mdui-menu-item">
              <a href="https://telegram.me/share/url?url=http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&text=Redis基础 学习笔记" target="_blank" class="mdui-ripple">分享到 Telegram</a>
            </li>
          </ul>
        
      </div>
    </header>
    <div class="mdui-card-content mdui-typo">
      <p>Redis 是一个内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。</p>
<hr>
<h2 id="NoSQL%E6%A6%82%E8%BF%B0"><a class="header-anchor" href="#NoSQL%E6%A6%82%E8%BF%B0">¶</a> NoSQL概述</h2>
<p>NoSQL = Not Only SQL 不仅仅是SQL</p>
<p>关系型数据库：表格，行、列</p>
<p>很多的数据类型，如用户的个人信息、社交网络、地理位置。这些数据类型的存储不需要一个固定的格式， 不需要多余的操作就可以横向扩展。</p>
<h4 id="%E7%89%B9%E7%82%B9"><a class="header-anchor" href="#%E7%89%B9%E7%82%B9">¶</a> 特点</h4>
<ol>
<li>方便扩展(数据之间没有关系，很好扩展! )</li>
<li>大数据量高性能( Redis一秒写8万次，读取11万，NoSQL的缓存记录级是一种细粒度的缓存，性能高!)</li>
<li>数据类型是多样型的（不需要事先设计数据库，随取随用）</li>
<li>传统RDBMS和NoSQL</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">传统的 RDBMS</span><br><span class="line">- 结构化组织</span><br><span class="line">- SQL</span><br><span class="line">- 数据和关系都存在单独的表中</span><br><span class="line">- 操作操作，数据定义语言</span><br><span class="line">- 严格的一致性</span><br><span class="line">- 基础的事务</span><br><span class="line">- ...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Nosq1</span><br><span class="line">- 不仅仅是数据</span><br><span class="line">- 没有固定的查询语言</span><br><span class="line">- 键值对存储，列存储，文档存储，图形数据库(社交关系)</span><br><span class="line">- 最终一致性，</span><br><span class="line">- CAP定理和BASE (异地多活)</span><br><span class="line">- 高性能，高可用，高可扩</span><br><span class="line">- ...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>大数据的3V+3高</p>
<p>描述问题的：</p>
<ol>
<li>海量Volume</li>
<li>多样Variety</li>
<li>实时Velocity</li>
</ol>
<p>对程序的要求：</p>
<ol>
<li>高并发</li>
<li>高可拓</li>
<li>高性能</li>
</ol>
</blockquote>
<h2 id="%E4%BA%94%E7%A7%8D%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><a class="header-anchor" href="#%E4%BA%94%E7%A7%8D%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">¶</a> 五种基本数据类型</h2>
<h3 id="Key%EF%BC%88%E9%94%AE%EF%BC%89"><a class="header-anchor" href="#Key%EF%BC%88%E9%94%AE%EF%BC%89">¶</a> Key（键）</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark -h localhost -p 6379 -c 100 -n 100000</span><br><span class="line">select x	<span class="comment">#切换数据库</span></span><br><span class="line">keys *	<span class="comment">#查看数据库所有key</span></span><br><span class="line">del key 	<span class="comment">#删除key </span></span><br><span class="line">flushdb	<span class="comment">#清空当前数据库</span></span><br><span class="line">flushall	<span class="comment">#清空全部数据库</span></span><br><span class="line">exists key</span><br><span class="line"><span class="built_in">type</span> key</span><br><span class="line">move key 2	<span class="comment">#将kv移动到指定的库</span></span><br><span class="line">expire key sec	<span class="comment">#设置kv过期时间</span></span><br><span class="line">ttl key	<span class="comment">#查看剩余时间</span></span><br></pre></td></tr></table></figure>
<h3 id="String(%E5%AD%97%E7%AC%A6%E4%B8%B2)"><a class="header-anchor" href="#String(%E5%AD%97%E7%AC%A6%E4%B8%B2)">¶</a> String(字符串)</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&gt;strlen k1 <span class="comment">#获取value的长度</span></span><br><span class="line">&gt;append k1 str <span class="comment">#追加字符串，如果key不存在则相当于set key</span></span><br><span class="line"></span><br><span class="line">&gt;incr num <span class="comment">#加一</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt;get num</span><br><span class="line"><span class="string">&quot;2&quot;</span></span><br><span class="line">&gt; decr num <span class="comment">#减一</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; incrby num 5 <span class="comment">#加一，步长为5</span></span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">&gt; get k1</span><br><span class="line"><span class="string">&quot;strstr&quot;</span></span><br><span class="line">&gt;getrange k1 1 2 <span class="comment">#截取字符串[1, 2]</span></span><br><span class="line"><span class="string">&quot;tr&quot;</span></span><br><span class="line">&gt; getrange k1 1 -1 <span class="comment">#-1表示末尾</span></span><br><span class="line"><span class="string">&quot;trstr&quot;</span></span><br><span class="line">&gt; setrange k1 2 x <span class="comment">#替换指定位置的字符</span></span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">get k1</span><br><span class="line"><span class="string">&quot;stxstr&quot;</span></span><br><span class="line"><span class="comment"># setex 设置含过期时间</span></span><br><span class="line"><span class="comment"># getnx key不存在才设置值（分布式锁中常用）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mset	msetnx(当且仅当所有给定 key 都不存在才设值)</span></span><br><span class="line"><span class="comment">#mget</span></span><br><span class="line"><span class="comment"># HashTag即是用&#123;&#125;包裹key的一个子串，如&#123;k&#125;1，</span></span><br><span class="line"><span class="comment">#两个key拥有相同的HashTag:&#123;k&#125;, 它们会被分配到同一个slot，从而可使用MGET命令</span></span><br><span class="line">&gt; mset &#123;k&#125;1 v1 &#123;k&#125;2 v2 &#123;k&#125;3 v3</span><br><span class="line">OK</span><br><span class="line">mget &#123;k&#125;1 &#123;k&#125;2 &#123;k&#125;3</span><br><span class="line">1) <span class="string">&quot;v1&quot;</span></span><br><span class="line">2) <span class="string">&quot;v2&quot;</span></span><br><span class="line">3) <span class="string">&quot;v3&quot;</span></span><br><span class="line">&gt; <span class="built_in">set</span> user:1 &#123;name:zs,age:21&#125;</span><br><span class="line">OK</span><br><span class="line">&gt; get user:1</span><br><span class="line"><span class="string">&quot;&#123;name:zs,age:21&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># getset</span></span><br><span class="line">&gt; get k1</span><br><span class="line"><span class="string">&quot;str&quot;</span></span><br><span class="line">&gt; getset k1 str2 <span class="comment"># 获取原来的值并设置新的值</span></span><br><span class="line"><span class="string">&quot;str&quot;</span></span><br><span class="line">&gt; get k1</span><br><span class="line"><span class="string">&quot;str2&quot;</span></span><br></pre></td></tr></table></figure>
<p>String类型使用场景：</p>
<ul>
<li>计数器</li>
<li>统计多单位的数量</li>
<li>抢购
<ul>
<li>通过exists判断是否存在，如果不存在则先通过setnx初始化值，之后通过decrby判断商品数是否大于0，大于则抢购成功，否则失败</li>
</ul>
</li>
</ul>
<h3 id="List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><a class="header-anchor" href="#List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89">¶</a> List（列表）</h3>
<p>栈、队列、阻塞队列</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">&gt; lpush l1 one <span class="comment">#将一个或多个值插入到列表 key 的表头</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; lpush l1 two</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt; lpush l1 three</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">&gt; rpush l1 rone <span class="comment">#将一个或多个值插入到列表 key 的表尾</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">4) <span class="string">&quot;rone&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; lpop l1 <span class="comment">#移除并返回列表 key 的头元素。</span></span><br><span class="line"><span class="string">&quot;three&quot;</span></span><br><span class="line">&gt; rpop l1 <span class="comment">#移除并返回列表 key 的尾元素。</span></span><br><span class="line"><span class="string">&quot;rone&quot;</span></span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; lindex l1 0 <span class="comment">#返回列表 key 中，下标为 index 的元素。</span></span><br><span class="line"><span class="string">&quot;two&quot;</span></span><br><span class="line">&gt; lindex l1 -1</span><br><span class="line"><span class="string">&quot;one&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; llen l1 <span class="comment">#返回列表的长度</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">4) <span class="string">&quot;three&quot;</span></span><br><span class="line">&gt; lrem l1 2 three <span class="comment"># 移除列表中|count|个value元素</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># count&gt;0: 表头-&gt;表尾；&lt;0: 表尾-&gt;表头；=0: 所有</span></span><br><span class="line">&gt; lrem l1 -1 three</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">&gt; lrem l1 1 three</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">&gt; lrem l1 0 three</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">4) <span class="string">&quot;value&quot;</span></span><br><span class="line">&gt; ltrim l1 2 3 <span class="comment">#修剪list</span></span><br><span class="line">OK</span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;value&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="comment"># 将l1的最后一个元素弹出，并返回给客户端。</span></span><br><span class="line"><span class="comment"># 并将弹出的元素作为l2的头元素 （）</span></span><br><span class="line">&gt; rpoplpush l1 l2 </span><br><span class="line"><span class="string">&quot;three&quot;</span></span><br><span class="line">&gt; lrange l1 0 -1</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">&gt; lrange l2 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; exists l1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; lset l1 1 two2 <span class="comment">#将列表下标为index的值设置为value</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将value插入到列表的值pivot的前面或后面</span></span><br><span class="line"><span class="comment"># linsert key before|after pivot value</span></span><br><span class="line">&gt; linsert l1 after two2 insert</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure>
<h3 id="Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><a class="header-anchor" href="#Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89">¶</a> Set（集合）</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&gt; sadd set1 hello</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; sadd set1 one</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; sadd set1 two</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; smembers set1 <span class="comment">#查看set的所有成员</span></span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello&quot;</span></span><br><span class="line">&gt; sismember set1 one <span class="comment">#判断元素是否在集合中</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; scard set1 <span class="comment">#获取集合中元素数量</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; srem set1 one <span class="comment">#删除指定的元素</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">&gt; srandmember set1 </span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br><span class="line">&gt; srandmember set1 2 <span class="comment">#从集合中随机获取指定数量的元素</span></span><br><span class="line">1) <span class="string">&quot;memeber&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">&gt; spop set1 [count] <span class="comment">#随机移除一个元素并返回该元素</span></span><br><span class="line"><span class="string">&quot;memeber&quot;</span></span><br><span class="line">&gt; smove set1 set2 two <span class="comment">#将该元素从一个集合中移动到另一个集合中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 集合论：差集、交集、并集</span></span><br><span class="line">&gt; sadd &#123;<span class="built_in">set</span>&#125;1 one hello member</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; sadd &#123;<span class="built_in">set</span>&#125;2 one two three</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; sdiff &#123;<span class="built_in">set</span>&#125;1 &#123;<span class="built_in">set</span>&#125;2 <span class="comment">#差集 A-B</span></span><br><span class="line">1) <span class="string">&quot;member&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">&gt; sinter &#123;<span class="built_in">set</span>&#125;1 &#123;<span class="built_in">set</span>&#125;2 <span class="comment">#交集 A∩B</span></span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">&gt; sunion &#123;<span class="built_in">set</span>&#125;1 &#123;<span class="built_in">set</span>&#125;2 <span class="comment">#并集 A∪B</span></span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">3) <span class="string">&quot;member&quot;</span></span><br><span class="line">4) <span class="string">&quot;three&quot;</span></span><br><span class="line">5) <span class="string">&quot;two&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>共同关注</li>
<li>推荐好友</li>
<li>···</li>
</ul>
<h3 id="SortedSet%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><a class="header-anchor" href="#SortedSet%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89">¶</a> SortedSet（有序集合）</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&gt; zadd zset1 1 one</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; zadd zset1 2 two 3 three</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt; zrange zset1 0 -1</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; zadd score 75 zhangsan 87 lisi 60 wangwu</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; zrange score 1 2 <span class="comment">#返回指定下标区间的成员，按score值递增排列</span></span><br><span class="line">1) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">2) <span class="string">&quot;lisi&quot;</span></span><br><span class="line"><span class="comment"># 返回有序集中所有 score 值介于 min 和 max 之间(默认闭区间)的成员，并递增排列。</span></span><br><span class="line">&gt; zrangebyscore score -inf +inf <span class="comment">#区间[-∞, +∞]</span></span><br><span class="line">1) <span class="string">&quot;wangwu&quot;</span></span><br><span class="line">2) zhangsan </span><br><span class="line">3) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">&gt; zrangebyscore score 75 100 <span class="comment">#区间[75, 100]</span></span><br><span class="line">1) zhangsan </span><br><span class="line">2) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">&gt; zrangebyscore score (75 +inf <span class="comment">#区间(75, 100]</span></span><br><span class="line">1) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">&gt; zrangebyscore score (75 +inf withscores</span><br><span class="line">1) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">2) <span class="string">&quot;87&quot;</span></span><br><span class="line">&gt; zrevrange score 1 2</span><br><span class="line"><span class="comment"># 返回有序集中所有 score 值介于 max 和 min 之间(默认闭区间)的成员，并递减排列。</span></span><br><span class="line">&gt; zrevrangebyscore score 100 75</span><br><span class="line">1) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">2) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">&gt; zcount score 75 80</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt; zrem score lisi</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; zcard score</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>
<ul>
<li>1,普通消息 2, 重要消息   带权重存储</li>
</ul>
<h3 id="Hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89"><a class="header-anchor" href="#Hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89">¶</a> Hash（哈希）</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&gt; hset h1 f1 v1 <span class="comment">#将哈希表 key 中的域 field 的值设为 value 。</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; hget h1 f1</span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line">&gt; hmset h1 f1 v11 f2 hello f3 ye</span><br><span class="line">OK</span><br><span class="line">&gt; hmget h1 f1 f2 </span><br><span class="line">1) <span class="string">&quot;v11&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">&gt; hgetall h1 <span class="comment">#获取全部的域和值</span></span><br><span class="line">&gt; hdel h1 f3 <span class="comment">#删除指定的域</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">&gt; hlen h1</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt; hkeys h1 <span class="comment">#获取所有的域</span></span><br><span class="line">1) <span class="string">&quot;f1&quot;</span></span><br><span class="line">2) <span class="string">&quot;f2&quot;</span></span><br><span class="line">&gt; hvals h1 <span class="comment">#获取所有域的值</span></span><br><span class="line">1) <span class="string">&quot;v11&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; hset h1 f3 3</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; hincrby h1 f3 2 <span class="comment">#加上一个值</span></span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure>
<h2 id="%E4%B8%89%E7%A7%8D%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><a class="header-anchor" href="#%E4%B8%89%E7%A7%8D%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">¶</a> 三种特殊数据类型</h2>
<h3 id="Geospatial%EF%BC%88%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%EF%BC%89"><a class="header-anchor" href="#Geospatial%EF%BC%88%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%EF%BC%89">¶</a> Geospatial（地理位置）</h3>
<p>存储到sorted set中</p>
<ul>
<li>朋友定位</li>
<li>附近的人</li>
<li>打车距离</li>
<li>···</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; geoadd china:city 104.065735 30.659462 ChengDu <span class="comment">#添加位置的经纬度</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; geoadd china:city 116.405285 39.904989 BeiJing 121.472644 31.231706 ShangHai</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line">&gt; geopos china:city ChengDu <span class="comment">#获取指定成员的经纬度</span></span><br><span class="line">1) 1) <span class="string">&quot;104.06573742628097534&quot;</span></span><br><span class="line">   2) <span class="string">&quot;30.65946118872339099&quot;</span></span><br><span class="line">&gt; geopos china:city BeiJing ShangHai</span><br><span class="line">1) 1) <span class="string">&quot;116.40528291463851929&quot;</span></span><br><span class="line">   2) <span class="string">&quot;39.9049884229125027&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;121.47264629602432251&quot;</span></span><br><span class="line">   2) <span class="string">&quot;31.23170490709807012&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>GEODIST key member1 member2 [unit]</strong><br>
unit:</p>
<ul>
<li>m 表示单位为米。</li>
<li>km 表示单位为千米。</li>
<li>mi 表示单位为英里。</li>
<li>ft 表示单位为英尺。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; geodist china:city ChengDu ShangHai <span class="comment">#获取成都到上海的直线距离</span></span><br><span class="line"><span class="string">&quot;1660019.7699&quot;</span></span><br><span class="line">&gt; geodist china:city ChengDu ShangHai km</span><br><span class="line"><span class="string">&quot;1660.0198&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD(经纬度)] [WITHDIST(距离)] [WITHHASH] [COUNT count]</strong><br>
以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。<br>
<strong>GEORADIUSBYMEMBER key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count]</strong><br>
以给定成员为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</p>
<ul>
<li>附近的人 （当前定位+半径）</li>
<li>···</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; georadius china:city 104 30 100 km</span><br><span class="line">1) <span class="string">&quot;wuhou&quot;</span></span><br><span class="line">2) <span class="string">&quot;jingjiang&quot;</span></span><br><span class="line">3) <span class="string">&quot;ChengDu&quot;</span></span><br><span class="line">&gt; georadius china:city 104 30 100 km withdist</span><br><span class="line">1) 1) <span class="string">&quot;wuhou&quot;</span></span><br><span class="line">   2) <span class="string">&quot;71.5655&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;jingjiang&quot;</span></span><br><span class="line">   2) <span class="string">&quot;73.4188&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;ChengDu&quot;</span></span><br><span class="line">   2) <span class="string">&quot;73.6204&quot;</span></span><br><span class="line">&gt; georadius china:city 104 30 100000 m withdist count 1</span><br><span class="line">1) 1) <span class="string">&quot;wuhou&quot;</span></span><br><span class="line">   2) <span class="string">&quot;71565.4799&quot;</span></span><br><span class="line">&gt; georadiusbymember china:city ChengDu 100 km</span><br><span class="line">1) <span class="string">&quot;jingjiang&quot;</span></span><br><span class="line">2) <span class="string">&quot;ChengDu&quot;</span></span><br><span class="line">3) <span class="string">&quot;wuhou&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 该命令将返回11个字符的Geohash字符串</span></span><br><span class="line">&gt; geohash china:city jingjiang wuhou</span><br><span class="line">1) <span class="string">&quot;wm6n2kz2bw0&quot;</span></span><br><span class="line">2) <span class="string">&quot;wm3yrd3bd70&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="HyperLogLogs"><a class="header-anchor" href="#HyperLogLogs">¶</a> HyperLogLogs</h3>
<p>基数计算：统计一批数据中的不重复元素的个数<br>
优点：占用固定的内存大小，最多2^64 12kb，大小和元素个数有关<br>
缺点：有0.81%的标准误差，不能获取元素本身</p>
<ul>
<li>记录一天会执行多少次各不相同的搜索查询</li>
<li>···</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; pfadd &#123;pf&#125;1 a b c d <span class="comment">#将元素存入HyperLogLogs结构中</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; pfadd &#123;pf&#125;2 c d e f g</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; pfcount &#123;pf&#125;1 <span class="comment">#返回其近似基数，</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">&gt; pfcount &#123;pf&#125;1 &#123;pf&#125;2</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line">&gt; pfmerge &#123;pf&#125;3 &#123;pf&#125;1 &#123;pf&#125;2 <span class="comment">#合并两组集合，并集</span></span><br><span class="line">OK</span><br><span class="line">&gt; pfcount &#123;pf&#125;3</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br></pre></td></tr></table></figure>
<h3 id="Bitmap"><a class="header-anchor" href="#Bitmap">¶</a> Bitmap</h3>
<p>Blob类型，最大512MB</p>
<ul>
<li>签到打卡 365 bit=45.625 byte</li>
<li>统计活跃用户（或运算）</li>
<li>用户是否在线</li>
<li>···</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; setbit signin 0 1 <span class="comment">#设置或者清空key的value(字符串)在offset处的bit值。</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">&gt; setbit signin 1 0</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">&gt; setbit signin 2 0</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">&gt; setbit signin 3 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">&gt; setbit signin 4 0</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">&gt; setbit signin 5 0</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">&gt; getbit signin 4 <span class="comment">#返回offset处的bit值</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">&gt; bitcount signin</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line">&gt; BITOP AND dest key1 key2</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br></pre></td></tr></table></figure>
<h2 id="%E4%BA%8B%E5%8A%A1"><a class="header-anchor" href="#%E4%BA%8B%E5%8A%A1">¶</a> 事务</h2>
<h3 id="Redis%E7%9A%84%E4%BA%8B%E5%8A%A1"><a class="header-anchor" href="#Redis%E7%9A%84%E4%BA%8B%E5%8A%A1">¶</a> Redis的事务</h3>
<ul>
<li>开启事务（multi）</li>
<li>命令入队（…）</li>
<li>执行事务（exec）</li>
<li>取消事务 （discard）<br>
编译时异常：如命令错误，事务中所有的命令都不会被执行<br>
运行时异常：事务队列中，错误的命令抛出运行时异常，但其他命令是可以正常执行的</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> str string</span><br><span class="line">OK</span><br><span class="line">&gt; multi</span><br><span class="line">OK</span><br><span class="line">&gt; get str <span class="comment">#语法错误，事务不会被执行</span></span><br><span class="line">QUEUED</span><br><span class="line">&gt; <span class="built_in">set</span> str</span><br><span class="line">(error) ERR wrong number of arguments <span class="keyword">for</span> <span class="string">&#x27;set&#x27;</span> <span class="built_in">command</span></span><br><span class="line">&gt; <span class="built_in">exec</span></span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line"></span><br><span class="line">&gt; multi</span><br><span class="line">OK</span><br><span class="line">&gt; incr str <span class="comment">#会产生运行时异常，事务中的该条命令不会被执行</span></span><br><span class="line">QUEUED</span><br><span class="line">&gt; get str <span class="comment"># 正常执行</span></span><br><span class="line">QUEUED</span><br><span class="line">&gt; <span class="built_in">exec</span></span><br><span class="line">1) (error) ERR value is not an <span class="built_in">integer</span> or out of range</span><br><span class="line">2) <span class="string">&quot;string&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="%E7%9B%91%E6%8E%A7%20Watch"><a class="header-anchor" href="#%E7%9B%91%E6%8E%A7%20Watch">¶</a> 监控 Watch</h3>
<p>监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。<br>
<strong>悲观锁</strong></p>
<ul>
<li>认为写操作多，遇到并发写的可能性高，以每次在读写数据的时候都会上锁</li>
<li>java中的悲观锁就是Synchronized</li>
</ul>
<p><strong>乐观锁</strong></p>
<ul>
<li>认为读多写少，遇到并发写的可能性低</li>
<li>不会上锁，提交更新时会对数据冲突进行检测（比较版本号），失败则要重复读-比较-写的操作</li>
<li>CAS、version控制</li>
</ul>
<p>正常执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> &#123;a&#125;money 100</span><br><span class="line">OK</span><br><span class="line">&gt; <span class="built_in">set</span> &#123;a&#125;out 0</span><br><span class="line">OK</span><br><span class="line">&gt; watch money</span><br><span class="line">OK</span><br><span class="line">&gt; multi</span><br><span class="line">OK</span><br><span class="line">&gt; DECRBY money 20</span><br><span class="line">QUEUED</span><br><span class="line">&gt; INCRBY out 20</span><br><span class="line">QUEUED</span><br><span class="line">&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure>
<p>测试多进程修改值。如果修改失败，获取最新的值就行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; watch money</span><br><span class="line">OK</span><br><span class="line">&gt; multi</span><br><span class="line">OK</span><br><span class="line">&gt; DECRBY money 10</span><br><span class="line">QUEUED</span><br><span class="line">&gt; INCRBY out 10</span><br><span class="line">QUEUED</span><br><span class="line">&gt; <span class="built_in">exec</span> <span class="comment">#执行之前，另一个线程修改了值，这时就会导致事务执行失败</span></span><br><span class="line">(nil)</span><br><span class="line"></span><br><span class="line">&gt; unwatch <span class="comment"># 如果发现事务执行失败，则先解锁再重新监视（select version）</span></span><br><span class="line">OK</span><br><span class="line">&gt; watch money </span><br></pre></td></tr></table></figure>
<h2 id="SpringBoot%E6%95%B4%E5%90%88"><a class="header-anchor" href="#SpringBoot%E6%95%B4%E5%90%88">¶</a> SpringBoot整合</h2>
<p><strong>jedis</strong>：采用直连Redis Server，线程不安全，像BIO<br>
<strong>lettuce</strong>：连接基于netty，连接实例可以再多个线程间共享，线程安全，像NIO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &#123;&quot;redisTemplate&quot;&#125;)</span></span><br><span class="line"><span class="comment">// 默认的RedisTemplate设置较少</span></span><br><span class="line"><span class="comment">// 泛型都是Object，需要强转为&lt;Sring, Object&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">    RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">    template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">    <span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span> </span><br><span class="line"><span class="comment">//由于String比较常用，所以单独封装了一个</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">    StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate();</span><br><span class="line">    template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">    <span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义RedisTemplate</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(LettuceConnectionFactory lettuceConnectionFactory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(lettuceConnectionFactory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Json序列化配置</span></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="comment">// 指定要序列化的域，field,get和set,以及修饰符范围，ANY是都有包括private和public</span></span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        <span class="comment">// 指定序列化输入的类型，类必须是非final修饰的，final修饰的类，比如String,Integer等会抛出异常</span></span><br><span class="line">        om.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// key和hash的key 采用String的序列化方式</span></span><br><span class="line">        template.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        template.setHashKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        <span class="comment">// value和hash的value 采用Jackson的序列化方式</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Redis.conf"><a class="header-anchor" href="#Redis.conf">¶</a> Redis.conf</h2>
<h3 id="1.%20%E5%8C%85%E5%90%AB%20INCLUDES"><a class="header-anchor" href="#1.%20%E5%8C%85%E5%90%AB%20INCLUDES">¶</a> 1. 包含 INCLUDES</h3>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201001180930883-1603273481613.png" alt="0" class="fancybox"></p>
<h3 id="2.%20%E7%BD%91%E7%BB%9C%20NETWORK"><a class="header-anchor" href="#2.%20%E7%BD%91%E7%BB%9C%20NETWORK">¶</a> 2. 网络 NETWORK</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 192.168.26.128 127.0.0.1 <span class="comment"># 绑定的ip</span></span><br><span class="line">protected-mode yes <span class="comment"># 保护模式</span></span><br><span class="line">port 6379 <span class="comment"># 端口设置</span></span><br></pre></td></tr></table></figure>
<h3 id="3.%20%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE%20GENERAL"><a class="header-anchor" href="#3.%20%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE%20GENERAL">¶</a> 3. 通用配置 GENERAL</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes <span class="comment"># 以守护进程的方式运行，默认为no</span></span><br><span class="line">supervised no <span class="comment"># 可以通过upstart和systemd管理Redis守护进程, no/upstart/systemd/auto</span></span><br><span class="line">pidfile /var/run/redis_6379.pid <span class="comment"># 如果以后台的方式运行，需要指定一个pid文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志</span></span><br><span class="line"><span class="comment"># Specify the server verbosity level.</span></span><br><span class="line"><span class="comment"># This can be one of:</span></span><br><span class="line"><span class="comment"># debug (a lot of information, useful for development/testing)</span></span><br><span class="line"><span class="comment"># verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="comment"># notice (moderately verbose, what you want in production probably)</span></span><br><span class="line"><span class="comment"># warning (only very important / critical messages are logged)</span></span><br><span class="line">loglevel notice</span><br><span class="line">logfile <span class="string">&quot;&quot;</span> <span class="comment"># 日志文件路径</span></span><br><span class="line"> </span><br><span class="line">databases 16 <span class="comment"># 默认16个数据库</span></span><br><span class="line">always-show-logo yes <span class="comment"># 显示Redis Logo</span></span><br></pre></td></tr></table></figure>
<h3 id="4.%20%E5%BF%AB%E7%85%A7%20SNAPSHOTTING"><a class="header-anchor" href="#4.%20%E5%BF%AB%E7%85%A7%20SNAPSHOTTING">¶</a> 4. 快照 SNAPSHOTTING</h3>
<p>持久化，在规定的时间内执行了多少次写操作，则会持久化到文件中，rdb、aof。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">save 900 1 <span class="comment"># 如果至少有1个key发生变化，900秒后则会进行持久化操作</span></span><br><span class="line">save 300 10 <span class="comment"># 如果至少有是10个key发生变化，300秒后则会进行持久化操作</span></span><br><span class="line">save 60 10000 <span class="comment"># 如果至少有是10000个key发生变化，60秒后则会进行持久化操作</span></span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error no <span class="comment"># 持久化出错后，是否需要继续工作</span></span><br><span class="line">rdbcompression yes <span class="comment"># 是否压缩rdb文件，需要消耗一CPU资源</span></span><br><span class="line">rdbchecksum yes <span class="comment"># 保存和加载rdb文件时是否进行错误的检查效验</span></span><br><span class="line">dbfilename dump.rdb <span class="comment"># rdb文件名</span></span><br><span class="line">dir ./ <span class="comment"># rdb文件保存路径</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="5.%20%E5%A4%8D%E5%88%B6%20REPLICATION"><a class="header-anchor" href="#5.%20%E5%A4%8D%E5%88%B6%20REPLICATION">¶</a> 5. 复制 REPLICATION</h3>
<p>主从复制</p>
<h3 id="6.%20%E5%AE%89%E5%85%A8%20SECURITY"><a class="header-anchor" href="#6.%20%E5%AE%89%E5%85%A8%20SECURITY">¶</a> 6. 安全 SECURITY</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">requirepass foobared <span class="comment"># 设置密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过命令更改密码</span></span><br><span class="line">&gt; config get requirepass</span><br><span class="line">1) <span class="string">&quot;requirepass&quot;</span></span><br><span class="line">2) <span class="string">&quot;&quot;</span></span><br><span class="line">&gt; config <span class="built_in">set</span> requirepass <span class="string">&quot;123456&quot;</span></span><br><span class="line">OK</span><br><span class="line">&gt; ping</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line">&gt; auth 123456</span><br><span class="line">OK</span><br><span class="line">&gt; config get requirepass</span><br><span class="line">1) <span class="string">&quot;requirepass&quot;</span></span><br><span class="line">2) <span class="string">&quot;123456&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="7.%20%E5%AE%A2%E6%88%B7%E7%AB%AF%20CLIENTS"><a class="header-anchor" href="#7.%20%E5%AE%A2%E6%88%B7%E7%AB%AF%20CLIENTS">¶</a> 7. 客户端 CLIENTS</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxclients 10000 <span class="comment"># 设置同时连接的最大客户端数量</span></span><br></pre></td></tr></table></figure>
<h3 id="8.%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%20MEMORY%20MANAGEMENT"><a class="header-anchor" href="#8.%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%20MEMORY%20MANAGEMENT">¶</a> 8. 内存管理 MEMORY MANAGEMENT</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">maxmemory &lt;bytes&gt; <span class="comment"># 配置Redis最大内存限制</span></span><br><span class="line"></span><br><span class="line">axmemory-policy noeviction <span class="comment">#达到内存上限时Redis采用的清除策略</span></span><br><span class="line">    1）volatile-lru	利用LRU算法移除有设置过期时间的key (LRU:最近使用 Least Recently Used ) </span><br><span class="line">    2）allkeys-lru	利用LRU算法移除任何key </span><br><span class="line">    3）volatile-random	移除有设置过期时间的随机key </span><br><span class="line">    4）allkeys-random	移除随机key</span><br><span class="line">    5）volatile-ttl	移除即将过期的key(minor TTL) </span><br><span class="line">    6）noeviction  noeviction	不移除任何key，只是返回一个写错误 。默认选项</span><br></pre></td></tr></table></figure>
<h3 id="9.%20AOF%E9%85%8D%E7%BD%AE%20APPEND%20ONLY%20MODE"><a class="header-anchor" href="#9.%20AOF%E9%85%8D%E7%BD%AE%20APPEND%20ONLY%20MODE">¶</a> 9. AOF配置 APPEND ONLY MODE</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">appendonly no <span class="comment"># 默认不开启aof，在大部分情况下rdb已经够用了</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span> <span class="comment"># 持久化的文件名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># appendfsync always # 每次修改都会fsync()，安全但比较慢且耗性能</span></span><br><span class="line">appendfsync everysec <span class="comment"># 每秒执行一次fsync()，可能丢失1s的数据</span></span><br><span class="line"><span class="comment"># appendfsync no # 不执行fsync()，让操作系统自己同步数据，最快</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重写规则</span></span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line">auto-aof-rewrite-percentage 100 <span class="comment">#当aof日志大小增长率大于该值时，自动开启重写</span></span><br><span class="line">auto-aof-rewrite-min-size 64mb <span class="comment">#当aof日志大小增长到该值时，自动开启重写</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Redis%E6%8C%81%E4%B9%85%E5%8C%96"><a class="header-anchor" href="#Redis%E6%8C%81%E4%B9%85%E5%8C%96">¶</a> Redis持久化</h2>
<p>Redis是内存数据库，如果没有持久化，那么断电后就会失去数据，所以Redis提供了持久化的功能。</p>
<h3 id="RDB%EF%BC%88Redis%20Database%EF%BC%89"><a class="header-anchor" href="#RDB%EF%BC%88Redis%20Database%EF%BC%89">¶</a> RDB（Redis Database）</h3>
<p>在指定的时间间隔类将内存中的数据集进行快照存储，恢复的时候则将快照文件加载到内存中。</p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002175210711-1603273481614.png" alt="rdb持久化过程" class="fancybox"></p>
<p>RDB在保存文件时父进程会单独创建（fork）一个子线程来进行持久化操作，先将数据写入一个临时文件中，写完成后，再用其替换掉上次已持久化的文件。整个过程主线程不进行IO操作，故而确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那么RDB方式要比AOF方式更加的高效。</p>
<p><strong>触发机制</strong></p>
<ol>
<li>save的规则满足的情况下，会自动触发RDB操作</li>
<li>执行flushall命令</li>
<li>退出Redis，也会产生RDB 文件</li>
</ol>
<p>备份就自动生成了一个dump.rdb文件</p>
<p><strong>恢复rdb文件</strong></p>
<ol>
<li>
<p>只需要将rbd文件放在Redis配置目录，启动时会自动检查dump.rdb并从中恢复数据</p>
</li>
<li>
<p>查看rdb文件保存路径</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; config get dir </span><br><span class="line">1) <span class="string">&quot;dir&quot;</span></span><br><span class="line">2) <span class="string">&quot;/usr/local/redis/redis-cluster/7001&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>优点：</strong></p>
<ul>
<li>RDB是一个单一的紧凑的文件，方便传输</li>
<li>适用于数据集的备份，可以根据需求恢复到不同版本的数据集</li>
<li>适合大规模的数据恢复</li>
</ul>
<p><strong>缺点:</strong></p>
<ul>
<li>由于需要一定时间间隔进行操作，在Redis意外宕机时丢失的数据较多</li>
<li>当数据集比较大的时候，创建子进程的过程是非常耗时的，可能会导致Redis在一些毫秒级内不能响应客户端的请求。</li>
</ul>
<h3 id="AOF%EF%BC%88Append%20Only%20File%EF%BC%89"><a class="header-anchor" href="#AOF%EF%BC%88Append%20Only%20File%EF%BC%89">¶</a> AOF（Append Only File）</h3>
<p>以日志文本的形式记录Redis所处理的每一个写操作，恢复的时候把文件汇中的命令都执行一遍即可。</p>
<p>命令实时写入和重写(rewrite)，由于缓存的写操作是实时写入aof文件，当触发重写规则（如：aof文件过大）时，会重新生成恢复当前数据集所需的最小命令集合，即rewrite操作。</p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002191438203-1603273481614.png" alt="rewrite流程" class="fancybox"></p>
<p>appendonly.aof</p>
<p>如果aof文件有问题，redis启动不了，可以通过<code>redis-check-aof --fix</code>工具修复aof文件。</p>
<p><strong>优点：</strong></p>
<ul>
<li>每一次修改都同步，文件的完整性更好</li>
<li>每秒fsync时，可能会丢失一秒的数据，</li>
</ul>
<p><strong>缺点:</strong></p>
<ul>
<li>对于相同的数据集来说，aof文件体积远大于rdb，修复速度也比rdb慢</li>
<li>根据所使用的 fsync 策略，AOF 的速度可能会慢于 RDB。在处理巨大的写入载入时，RDB 可以提供更有保证的最大延迟时间（latency）</li>
</ul>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002223857890-1603273481615.png" alt="image-20201002223857890" class="fancybox"></p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002223944105-1603273481615.png" alt="image-20201002223944105" class="fancybox"></p>
<h2 id="Redis%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85"><a class="header-anchor" href="#Redis%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85">¶</a> Redis发布与订阅</h2>
<p>Redis发布订阅(pub/sub)是一种<mark>消息通信模式</mark>：发送者(pub)发送消息，订阅者(sub)接收消息。传送消息的链路称为<mark>信道</mark>。</p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002225013710-1603273481615.png" alt="image-20201002225013710" class="fancybox"></p>
<p><strong>命令</strong></p>
<table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-psubscribe.html">PSUBSCRIBE pattern [pattern …]</a></td>
<td>订阅一个或多个符合给定模式的频道。</td>
</tr>
<tr>
<td>2</td>
<td>[PUBSUB subcommand <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-pubsub.html">argument [argument …]]</a></td>
<td>查看订阅与发布系统状态。</td>
</tr>
<tr>
<td>3</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-publish.html">PUBLISH channel message</a></td>
<td>将信息发送到指定的频道。</td>
</tr>
<tr>
<td>4</td>
<td>[ PUNSUBSCRIBE <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-punsubscribe.html">pattern [pattern …]]</a></td>
<td>退订所有给定模式的频道。</td>
</tr>
<tr>
<td>5</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-subscribe.html"> SUBSCRIBE channel [channel …]</a></td>
<td>订阅给定的一个或多个频道的信息。</td>
</tr>
<tr>
<td>6</td>
<td>[ UNSUBSCRIBE <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-unsubscribe.html">channel [channel …]]</a></td>
<td>只退订给定的频道。</td>
</tr>
</tbody>
</table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; SUBSCRIBE MyChannel <span class="comment"># 订阅频道</span></span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;MyChannel&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># 等待读取推送的信息</span></span><br><span class="line">1) <span class="string">&quot;message&quot;</span> <span class="comment"># 消息</span></span><br><span class="line">2) <span class="string">&quot;MyChannel&quot;</span> <span class="comment"># 来自哪个频道的消息</span></span><br><span class="line">3) <span class="string">&quot;hello,test&quot;</span> <span class="comment"># 消息的具体内容</span></span><br><span class="line"></span><br><span class="line">&gt; PUBLISH MyChannel <span class="string">&quot;hello,test&quot;</span> <span class="comment"># 将信息发送到指定的频道</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>
<p><strong>使用场景</strong></p>
<ul>
<li>用于构建即时通信应用，如：网络聊天室、实时广播、实时提醒等</li>
<li>订阅、关注系统</li>
</ul>
<p>较复杂的场景会使用消息中间件 MQ</p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201002232010221-1603273481615.png" alt="image-20201002232010221" class="fancybox"></p>
<h2 id="Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><a class="header-anchor" href="#Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6">¶</a> Redis主从复制</h2>
<h4 id="%E6%A6%82%E5%BF%B5"><a class="header-anchor" href="#%E6%A6%82%E5%BF%B5">¶</a> 概念</h4>
<p>主从复制,是指将一台Redis服务器的数据,复制到其他的Redis服务器。前者称为主节点(master/leader)，后者称为从节点(slave/follower) ；数据的复制是单向的，只能由主节点到从节点。Master以写为主，Slave 以读为主（读写分离）。</p>
<p>默认情况下，每台Redis服务器都是主节点；且一个主节点可以有多个从节点(或没有从节点) ，但一个从节点只能有一个主节点。</p>
<p>主从复制的作用主要包括：</p>
<ol>
<li><strong>数据冗余：</strong> 主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</li>
<li><strong>故障恢复：</strong> 当主节点出现问题时，可以由从节点提供服务,实现快速的故障恢复；实际上是-一种服务的冗余。</li>
<li><strong>负载均衡：</strong> 在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务(即写Redis数据时应用连接主节点,读Redis数据时应用连接从节点)，分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</li>
<li><strong>高可用基石：</strong> 除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是Redis高可用的基础。</li>
</ol>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201003180444252-1603273481615.png" alt="image-20201003180444252" class="fancybox"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; info replication <span class="comment"># 查看当前redis节点信息</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=192.168.26.128,port=7006,state=online,offset=280,lag=1</span><br><span class="line">master_replid:8a90b2da230485bb190eb2e443bb324cbb8d7371</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:280</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:280</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="%E6%90%AD%E5%BB%BA"><a class="header-anchor" href="#%E6%90%AD%E5%BB%BA">¶</a> <strong>搭建</strong></h4>
<h5 id="1.%20%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><a class="header-anchor" href="#1.%20%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">¶</a> 1. 修改配置文件</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> </span><br><span class="line">port 7001</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /var/run/redis_7001.pid</span><br><span class="line">logfile <span class="string">&quot;redis_7001.log&quot;</span></span><br><span class="line">dbfilename dump_7006.rdb</span><br><span class="line">cluster-enabled yes <span class="comment"># 开启集群  </span></span><br><span class="line">cluster-config-file nodes_7001.conf   <span class="comment"># 集群的配置 配置文件</span></span><br><span class="line">cluster-node-timeout  15000      </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="2.%20%E8%84%9A%E6%9C%AC%E5%90%AF%E5%8A%A8%E6%96%87%E4%BB%B6start.sh"><a class="header-anchor" href="#2.%20%E8%84%9A%E6%9C%AC%E5%90%AF%E5%8A%A8%E6%96%87%E4%BB%B6start.sh">¶</a> 2. 脚本启动文件<code>start.sh</code></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cd</span> 7001 &amp;&amp; ../../bin/redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ../7002 &amp;&amp; ../../bin/redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ../7003 &amp;&amp; ../../bin/redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<h5 id="3.%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE%EF%BC%88master-slave%20replication%EF%BC%89%EF%BC%88%E8%BF%98%E6%9C%89%E5%A4%9A%E7%BA%A7%E5%A4%8D%E5%88%B6%EF%BC%89"><a class="header-anchor" href="#3.%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE%EF%BC%88master-slave%20replication%EF%BC%89%EF%BC%88%E8%BF%98%E6%9C%89%E5%A4%9A%E7%BA%A7%E5%A4%8D%E5%88%B6%EF%BC%89">¶</a> 3. 主从复制模式配置（master-slave replication）（还有多级复制）</h5>
<ul>
<li>
<p>一主二从，命令中配置，本次运行有效</p>
<p>主机可以设置值，从机只能读；</p>
<p>主机宕机后，从机依旧连接到主机，主机重启后从机会自动连接上；</p>
<p>从机重启后，则会变为主机，只要又设置为从机，则会立即从主机复制数据；</p>
<p>如果主机断开了连接，可以使用<code>SLAVEOF no one</code>让自己变成主机，其他的节点就可以手动连接到最新的这个主节点( 手动选举)。</p>
</li>
</ul>
<blockquote>
<p>复制原理</p>
<p>Slave启动成功连接到master后会发送一个sync同步命令<br>
Master接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕之后， <mark>master将传送整个数据文件到slave，并完成一-次完全同步。</mark><br>
<strong>全量复制：</strong> 而slave服务在接收到数据库文件数据后,将其存盘并加载到内存中。<br>
<strong>增量复制：</strong> Master继续将新的所有收集到的修改命令依次传给slave，完成同步<br>
但是只要是重新连接master , 一次完全同步(全量复制)将被自动执行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt;SLAVEOF 127.0.0.1 7001</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave <span class="comment"># 从节点</span></span><br><span class="line">master_host:192.168.26.128</span><br><span class="line">master_port:7001 <span class="comment"># 它的主节点</span></span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:1</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:2128</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:c4b29fdc590e84132d6055078fa03306a6ed1cbf</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:2128</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:2128</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="4.%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%EF%BC%88%20Sentinel%EF%BC%89"><a class="header-anchor" href="#4.%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%EF%BC%88%20Sentinel%EF%BC%89">¶</a> 4. 哨兵模式（ Sentinel）</h5>
<p>哨兵模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程,作为进程,它会独立运行。</p>
<p>三个任务：</p>
<ul>
<li><strong>监控（Monitoring）</strong>： Sentinel 会不断地检查主服务器和从服务器是否运作正常。</li>
</ul>
<ul>
<li><strong>提醒（Notification）</strong>： 当被监控的某个 Redis 服务器出现问题时， Sentinel 可以通过 API 向管理员或者其他应用程序发送通知。</li>
<li><strong>自动故障迁移（Automatic failover）</strong>：当一个主服务器不能正常工作时， Sentinel 会使用投票协议（agreement protocols）来决定是否执行自动故障迁移， 以及选择哪个从服务器作为新的主服务器。</li>
</ul>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201003193304549-1603273481616.png" alt="哨兵模式" class="fancybox"></p>
<p>这里的哨兵有两个作用</p>
<ul>
<li>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器。</li>
<li>当哨兵监测到master宕机，会自动将slave切换成master，然后通过<mark>发布订阅</mark>模式通知其他的从服务器,修改配置文件，让它们切换主机。</li>
</ul>
<p>然而一个哨兵进程对Redis服务器进行监控,可能会出现问题，为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控,这样就形成了多哨兵模式。</p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201003193545996-1603273481616.png" alt="多哨兵模式" class="fancybox"></p>
<p>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象成为<strong>主观下线</strong>。当后面的哨兵也检测到主服务器不可用,并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover[故障转移]操作。切换成功后，就会通过发布订阅模式,让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<strong>客观下线</strong>。</p>
<p><strong>配置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 监视一个名为mymaster的主服务器，其IP为127.0.0.1和port为7001，</span></span><br><span class="line"><span class="comment"># 2代表至少需要2个Sentinel同意（大多数Sentinel正常），该服务器才被判断为已失效宕机 </span></span><br><span class="line">sentinel monitor mymaster 127.0.0.1 7001 2</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看节点信息</span></span><br><span class="line">./redis-cli -h 192.168.26.128 -c -p 7001 cluster nodes</span><br></pre></td></tr></table></figure>
<h2 id="Redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E5%92%8C%E9%9B%AA%E5%B4%A9"><a class="header-anchor" href="#Redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E5%92%8C%E9%9B%AA%E5%B4%A9">¶</a> Redis缓存穿透和雪崩</h2>
<p>Redis缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面。但同时，它也带来了一些问题。其中，最要害的问题，就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据的一致性要求很高，那么就不能使用缓存。</p>
<p>另外的一些典型问题就是，缓存穿透、缓存雪崩和缓存击穿。目前，业界也都有比较流行的解决方案。</p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201021164003157.png" alt="image-20201021164003157" class="fancybox"></p>
<h4 id="%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><a class="header-anchor" href="#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F">¶</a> 缓存穿透</h4>
<blockquote>
<p><strong>概念：</strong></p>
</blockquote>
<p>​		缓存穿透的概念很简单，用户想要查询一个数据，发现redis数据库没有，即缓存未命中，于是从持久层数据库查询。发现也没有，则本次查询失败。当用户很多的时候，缓存都没有命中(秒杀! )，于是都去请求持久层数据库。这就给持久层数据库带来很大的压力，这时候就相当于出现了缓存穿透。</p>
<blockquote>
<p><strong>解决方案：</strong></p>
</blockquote>
<p><strong>布隆过滤器</strong></p>
<p>布隆过滤器是一种数据结构，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存储系统的查询压力;</p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201021165228987.png" alt="image-20201021165228987" class="fancybox"></p>
<p><strong>缓存空对象</strong></p>
<p>当存储层未命中后，即使返回的是空对象也将其缓存起来，同时设置一个过期时间，之后再访问该数据将会从缓存中获取，避免了给后端数据库带来压力。</p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201021165652288.png" alt="image-20201021165652288" class="fancybox"></p>
<p>但是这种方法会存在两个问题：</p>
<ol>
<li>如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键；</li>
<li>即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</li>
</ol>
<h4 id="%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><a class="header-anchor" href="#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF">¶</a> 缓存击穿</h4>
<blockquote>
<p><strong>概述</strong></p>
</blockquote>
<p>​		这里需要注意和缓存击穿的区别缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。</p>
<p>​		当某个key在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导使数据库瞬间压力过大。</p>
<blockquote>
<p><strong>解决方案</strong></p>
</blockquote>
<p><strong>设置热点数据永不过期</strong></p>
<p>从缓存层面来看，没有设置过期时间，所以不会出现热点key过期后产生的问题。</p>
<p><strong>加互斥锁</strong></p>
<p>分布式锁：使用分布式锁，保证对于每个key同时只有一个线程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高井发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201021170505844.png" alt="image-20201021170505844" class="fancybox"></p>
<h4 id="%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><a class="header-anchor" href="#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9">¶</a> 缓存雪崩</h4>
<p>缓存雪崩，是指在某一个时间段，缓存集中过期失效，Redis 宕机。</p>
<p>比如在写本文的时候,马上就要到双11零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言,就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p>
<p><img src="/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20201021170804287.png" alt="image-20201021170804287" class="fancybox"></p>
<p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知的，很有可能瞬间就把数据库压垮。</p>
<p>双11：停掉一些服务，( 保证主要的服务可用 )</p>
<blockquote>
<p><strong>解决方案</strong></p>
</blockquote>
<p><strong>redis高可用</strong></p>
<p>这个思想的含义是，既然redis有可能挂掉，那我多增设几台redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群。（异地多活）</p>
<p><strong>限流降级</strong></p>
<p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p>
<p><strong>数据预热</strong></p>
<p>数据加热的含义就是在正式部署之前，先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css">
      
        <div class="mdui-m-y-2 mdui-text-center">
          <button class="mdui-fab mdui-color-deep-orange mdui-text-color-white mdui-ripple" mdui-dialog="{target: '#donate'}" mdui-tooltip="{content: '打赏', position: 'top'}"><i class="mdui-icon material-icons">thumb_up</i></button>
        </div>
      
      <blockquote>
        
        <strong>本文链接：</strong><br><a href="http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">http://lampkins.gitee.io/2020/09/16/Redis%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a>
      </blockquote>
    </div>
    <footer class="mdui-card-actions">
      
        <a class="mdui-ripple article_categories-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
      
      
        <a class="mdui-ripple article_tags-link" href="/tags/Java/" rel="tag">Java</a><a class="mdui-ripple article_tags-link" href="/tags/Redis/" rel="tag">Redis</a>
      
    </footer>
    
      <div class="mdui-dialog" id="donate">
        <div class="mdui-tab mdui-tab-centered">
          
            <a href="#donate-0" class="mdui-ripple">QQ支付</a>
          
            <a href="#donate-1" class="mdui-ripple">支付宝</a>
          
        </div>
        
        
          <div id="donate-0" class="mdui-p-a-2 mdui-typo mdui-text-center">
            
              <img src="/images/qqpay.jpg" style="width: 300px;">
            
          </div>
        
          <div id="donate-1" class="mdui-p-a-2 mdui-typo mdui-text-center">
            
              <img src="/images/alipay.jpg" style="width: 300px;">
            
          </div>
        
      </div>
    
  </article>
  
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.js"></script>

  <script>$("#main article .mdui-card-content img.fancybox").on("click",function(e){$.fancybox.open({src:$(this).attr("src")});});</script>


  <nav id="paginator">
    
      <a rel="prev" class="extend prev" href="/2020/09/20/Java%E8%99%9A%E6%8B%9F%E6%9C%BAJVM%E7%AC%94%E8%AE%B0/">
        <button aria-label="prev" class="mdui-btn mdui-btn-raised mdui-btn-icon mdui-color-theme-accent mdui-ripple"><i class="mdui-icon material-icons">arrow_back</i></button>
        <span class="mdui-p-x-3" mdui-tooltip="{content: 'Java虚拟机 JVM笔记'}">上一篇</span>
      </a>
    
    <div class="spacer"></div>
    
      <a rel="next" class="extend next" href="/2020/09/12/Markdown-Demo-%E6%B5%8B%E8%AF%95/">
        <span class="mdui-p-x-3" mdui-tooltip="{content: 'Markdown Demo 测试'}">下一篇</span>
        <button aria-label="next" class="mdui-btn mdui-btn-raised mdui-btn-icon mdui-color-theme-accent mdui-ripple"><i class="mdui-icon material-icons">arrow_forward</i></button>
      </a>
    
  </nav>


  <div id="comment" class="mdui-m-t-5 mdui-m-x-1">
    <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
  var gitalk = new Gitalk({
    clientID: 'd17f668bcd7f140d735f',
    clientSecret: '3058f2300347db4f27a87d10648565e8d0549033',
    repo: 'Lampkins.github.io',
    owner: 'lampkins',
    admin: ['lampkins'],
    id: '4102fb6d-9348-d86a-e655-14e0a079d03d' || location.pathname,
    distractionFreeMode: false
  });
  gitalk.render('gitalk-container');
</script>
  </div>



  <div style="position: fixed !important; right: 16px; top: 30%;">
    <button class="mdui-fab mdui-fab-mini mdui-ripple" mdui-menu="{target: '#toc'}"><i class="mdui-icon material-icons">toc</i></button>
    <ul class="mdui-menu" id="toc">
      <li class="mdui-menu-item" disabled><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#NoSQL%E6%A6%82%E8%BF%B0"><span class="toc-text"> NoSQL概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-text"> 特点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E7%A7%8D%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text"> 五种基本数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Key%EF%BC%88%E9%94%AE%EF%BC%89"><span class="toc-text"> Key（键）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#String(%E5%AD%97%E7%AC%A6%E4%B8%B2)"><span class="toc-text"> String(字符串)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><span class="toc-text"> List（列表）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-text"> Set（集合）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SortedSet%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-text"> SortedSet（有序集合）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89"><span class="toc-text"> Hash（哈希）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text"> 三种特殊数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Geospatial%EF%BC%88%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%EF%BC%89"><span class="toc-text"> Geospatial（地理位置）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HyperLogLogs"><span class="toc-text"> HyperLogLogs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bitmap"><span class="toc-text"> Bitmap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-text"> 事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E7%9A%84%E4%BA%8B%E5%8A%A1"><span class="toc-text"> Redis的事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%20Watch"><span class="toc-text"> 监控 Watch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E6%95%B4%E5%90%88"><span class="toc-text"> SpringBoot整合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis.conf"><span class="toc-text"> Redis.conf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1.%20%E5%8C%85%E5%90%AB%20INCLUDES"><span class="toc-text"> 1. 包含 INCLUDES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2.%20%E7%BD%91%E7%BB%9C%20NETWORK"><span class="toc-text"> 2. 网络 NETWORK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3.%20%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE%20GENERAL"><span class="toc-text"> 3. 通用配置 GENERAL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4.%20%E5%BF%AB%E7%85%A7%20SNAPSHOTTING"><span class="toc-text"> 4. 快照 SNAPSHOTTING</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5.%20%E5%A4%8D%E5%88%B6%20REPLICATION"><span class="toc-text"> 5. 复制 REPLICATION</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6.%20%E5%AE%89%E5%85%A8%20SECURITY"><span class="toc-text"> 6. 安全 SECURITY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7.%20%E5%AE%A2%E6%88%B7%E7%AB%AF%20CLIENTS"><span class="toc-text"> 7. 客户端 CLIENTS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8.%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%20MEMORY%20MANAGEMENT"><span class="toc-text"> 8. 内存管理 MEMORY MANAGEMENT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9.%20AOF%E9%85%8D%E7%BD%AE%20APPEND%20ONLY%20MODE"><span class="toc-text"> 9. AOF配置 APPEND ONLY MODE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text"> Redis持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB%EF%BC%88Redis%20Database%EF%BC%89"><span class="toc-text"> RDB（Redis Database）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%EF%BC%88Append%20Only%20File%EF%BC%89"><span class="toc-text"> AOF（Append Only File）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85"><span class="toc-text"> Redis发布与订阅</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text"> Redis主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-text"> 概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA"><span class="toc-text"> 搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1.%20%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text"> 1. 修改配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2.%20%E8%84%9A%E6%9C%AC%E5%90%AF%E5%8A%A8%E6%96%87%E4%BB%B6start.sh"><span class="toc-text"> 2. 脚本启动文件start.sh</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3.%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE%EF%BC%88master-slave%20replication%EF%BC%89%EF%BC%88%E8%BF%98%E6%9C%89%E5%A4%9A%E7%BA%A7%E5%A4%8D%E5%88%B6%EF%BC%89"><span class="toc-text"> 3. 主从复制模式配置（master-slave replication）（还有多级复制）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4.%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%EF%BC%88%20Sentinel%EF%BC%89"><span class="toc-text"> 4. 哨兵模式（ Sentinel）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E5%92%8C%E9%9B%AA%E5%B4%A9"><span class="toc-text"> Redis缓存穿透和雪崩</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="toc-text"> 缓存穿透</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="toc-text"> 缓存击穿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-text"> 缓存雪崩</span></a></li></ol></li></ol></li></ol></li>
    </ul>
  </div>
</main>
  <footer id="footer" class="mdui-m-t-5 mdui-p-y-3 mdui-color-theme">
  <div class="mdui-p-y-0 mdui-text-center">
    
      <a href="https://github.com/Lampkins" target="_blank" class="mdui-btn mdui-btn-icon mdui-text-color-theme-a100"><i class="mdui-icon iconfont">&#xe7ab;</i></a>
    
    
      <a href="https://gitee.com/lampkins" target="_blank" class="mdui-btn mdui-btn-icon mdui-text-color-theme-a100"><i class="mdui-icon iconfont1">&#xe686;</i></a>
    
    
    
    
    
    
      <a href="https://www.instagram.com/arimis0" target="_blank" class="mdui-btn mdui-btn-icon mdui-text-color-theme-a100"><i class="mdui-icon iconfont1">&#xe736;</i></a>
    
    
    
    
    
    
      <a href="https://qm.qq.com/cgi-bin/qm/qr?k=g3rAKPWjqKBJ7oezteErpQGrtxISDNmp&noverify=0" target="_blank" class="mdui-btn mdui-btn-icon mdui-text-color-theme-a100"><i class="mdui-icon iconfont">&#xe651;</i></a>
    
    
  </div>
  <div class="mdui-p-y-1 mdui-text-center">
    Copyright &copy; 2019 - 2023 Lampkins<br>
    Powered by <a href="https://hexo.io/" target="_blank" class="mdui-text-color-theme-accent">Hexo</a> | Theme by <a href="https://github.com/niemingzhao/niemingzhao.github.io/tree/theme" target="_blank" class="mdui-text-color-theme-accent">default</a>
    <br>
      <span id="busuanzi_container_site_pv" style="display: none;"><i class="iconfont">&#xe7fd;</i> <span id="busuanzi_value_site_pv"></span></span> &nbsp;&nbsp;
      <span id="busuanzi_container_site_uv" style="display: none;"><i class="iconfont">&#xe601;</i> <span id="busuanzi_value_site_uv"></span></span>
    
  </div>
</footer>
  <button id="gotop" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-color-theme-accent mdui-ripple"><i class="mdui-icon material-icons">arrow_upward</i></button>
  <script async src="http://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  
<script src="/js/mdui.js"></script>
<script src="/js/script.js"></script>

  
<script src="/custom.js"></script>

</body>
</html>